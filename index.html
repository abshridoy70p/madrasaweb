<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>নুরুল কোরআন কওমী মাদ্রাসা - ব্যবস্থাপনা সিস্টেম</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container-main {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header h1 {
            color: #764ba2;
            margin: 0;
            font-weight: 700;
        }
        
        .status-bar {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.online {
            background: #10b981;
        }
        
        .status-dot.offline {
            background: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .menu-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .menu-card i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .menu-card h3 {
            color: #333;
            font-weight: 600;
            margin: 0;
        }
        
        .content-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        
        .content-area.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .back-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-control {
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            padding: 12px;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #764ba2;
            transform: scale(1.05);
        }
        
        .btn-success {
            background: #10b981;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
        }
        
        .btn-danger {
            background: #ef4444;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
        }
        
        .btn-warning {
            background: #f59e0b;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            color: white;
        }
        
        .btn-info {
            background: #06b6d4;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
        }
        
        .table {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table thead {
            background: #667eea;
            color: white;
        }
        
        .table tbody tr:hover {
            background: #f3f4f6;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .stat-card h3 {
            font-size: 2.5rem;
            margin: 10px 0;
            font-weight: 700;
        }
        
        .stat-card p {
            margin: 0;
            font-size: 1.1rem;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            border-radius: 8px;
            padding: 12px;
            width: 100%;
            border: 2px solid #e0e0e0;
        }
        
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .pagination button {
            padding: 8px 15px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .loading i {
            font-size: 3rem;
            color: #667eea;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .receipt {
            background: white;
            padding: 40px;
            border: 3px solid #667eea;
            border-radius: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .receipt-header {
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .receipt-header h2 {
            color: #764ba2;
            margin: 10px 0;
        }
        
        .receipt-body {
            margin: 20px 0;
        }
        
        .receipt-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .receipt-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #667eea;
            text-align: center;
        }
        
        .phone-link {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
        }
        
        .phone-link:hover {
            text-decoration: underline;
        }
        
        .alert {
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt, .receipt * {
                visibility: visible;
            }
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
            }
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container-main">
        <!-- হেডার -->
        <div class="header">
            <i class="fas fa-mosque" style="font-size: 3rem; color: #667eea;"></i>
            <h1>নুরুল কোরআন কওমী মাদ্রাসা</h1>
            <p style="color: #666; margin: 10px 0 0 0;">সম্পূর্ণ ডিজিটাল ব্যবস্থাপনা সিস্টেম</p>
        </div>

        <!-- স্ট্যাটাস বার -->
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot online" id="statusDot"></div>
                <span id="statusText">অনলাইন</span>
            </div>
            <div>
                <span id="lastSync">শেষ সিঙ্ক: এখনই</span>
            </div>
        </div>

        <!-- মেইন মেনু -->
        <div id="mainMenu" class="menu-grid">
            <div class="menu-card" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i>
                <h3>ড্যাশবোর্ড</h3>
            </div>
            <div class="menu-card" onclick="showSection('studentManagement')">
                <i class="fas fa-users"></i>
                <h3>ছাত্র ব্যবস্থাপনা</h3>
            </div>
            <div class="menu-card" onclick="showSection('feeManagement')">
                <i class="fas fa-money-bill-wave"></i>
                <h3>বেতন ব্যবস্থাপনা</h3>
            </div>
            <div class="menu-card" onclick="showSection('examFee')">
                <i class="fas fa-file-invoice"></i>
                <h3>পরীক্ষার ফি</h3>
            </div>
            <div class="menu-card" onclick="showSection('reports')">
                <i class="fas fa-file-alt"></i>
                <h3>রিপোর্ট</h3>
            </div>
            <div class="menu-card" onclick="showSection('dataManagement')">
                <i class="fas fa-database"></i>
                <h3>ডেটা ব্যবস্থাপনা</h3>
            </div>
        </div>

        <!-- ড্যাশবোর্ড সেকশন -->
        <div id="dashboard" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-chart-line"></i> ড্যাশবোর্ড</h2>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-users" style="font-size: 2rem;"></i>
                    <h3 id="totalStudents">০</h3>
                    <p>মোট ছাত্র</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle" style="font-size: 2rem;"></i>
                    <h3 id="paidStudents">০</h3>
                    <p>বেতন পরিশোধিত</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-circle" style="font-size: 2rem;"></i>
                    <h3 id="unpaidStudents">০</h3>
                    <p>বেতন বাকি</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-money-bill-wave" style="font-size: 2rem;"></i>
                    <h3 id="totalCollection">০ ৳</h3>
                    <p>মোট আদায়</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h4>ক্লাসভিত্তিক ছাত্র সংখ্যা</h4>
                    <div class="chart-container">
                        <canvas id="classChart"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <h4>মাসিক আদায় পরিসংখ্যান</h4>
                    <div class="chart-container">
                        <canvas id="collectionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ছাত্র ব্যবস্থাপনা সেকশন -->
        <div id="studentManagement" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-users"></i> ছাত্র ব্যবস্থাপনা</h2>
            
            <div class="row mb-4">
                <div class="col-md-3">
                    <button class="btn btn-primary w-100" onclick="showAddStudentForm()">
                        <i class="fas fa-plus"></i> নতুন ছাত্র যোগ করুন
                    </button>
                </div>
                <div class="col-md-3">
                    <select class="form-control" id="classFilter" onchange="filterStudents()">
                        <option value="">সকল ক্লাস</option>
                        <option value="শিশু জামাত">শিশু জামাত</option>
                        <option value="প্রথম জামাত">প্রথম জামাত</option>
                        <option value="দ্বিতীয় জামাত">দ্বিতীয় জামাত</option>
                        <option value="তৃতীয় জামাত">তৃতীয় জামাত</option>
                        <option value="হিফজ বিভাগ">হিফজ বিভাগ</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <div class="search-box">
                        <input type="text" id="studentSearch" placeholder="ছাত্রের নাম বা রোল নং অনুসন্ধান করুন..." onkeyup="searchStudents()">
                    </div>
                </div>
            </div>

            <div id="studentTableContainer">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>রোল নং</th>
                            <th>নাম</th>
                            <th>পিতার নাম</th>
                            <th>ক্লাস</th>
                            <th>মোবাইল</th>
                            <th>ঠিকানা</th>
                            <th>কার্যক্রম</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                        <!-- ডাটা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination" id="studentPagination"></div>
        </div>

        <!-- বেতন ব্যবস্থাপনা সেকশন -->
        <div id="feeManagement" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-money-bill-wave"></i> বেতন ব্যবস্থাপনা</h2>
            
            <div class="row mb-4">
                <div class="col-md-4">
                    <label>মাস নির্বাচন করুন</label>
                    <input type="month" class="form-control" id="feeMonth" onchange="loadFeeData()">
                </div>
                <div class="col-md-4">
                    <label>ক্লাস নির্বাচন করুন</label>
                    <select class="form-control" id="feeClassFilter" onchange="loadFeeData()">
                        <option value="">সকল ক্লাস</option>
                        <option value="শিশু জামাত">শিশু জামাত</option>
                        <option value="প্রথম জামাত">প্রথম জামাত</option>
                        <option value="দ্বিতীয় জামাত">দ্বিতীয় জামাত</option>
                        <option value="তৃতীয় জামাত">তৃতীয় জামাত</option>
                        <option value="হিফজ বিভাগ">হিফজ বিভাগ</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>স্ট্যাটাস</label>
                    <select class="form-control" id="feeStatusFilter" onchange="loadFeeData()">
                        <option value="">সকল</option>
                        <option value="paid">পরিশোধিত</option>
                        <option value="unpaid">বাকি</option>
                    </select>
                </div>
            </div>

            <div id="feeTableContainer">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>রোল নং</th>
                            <th>নাম</th>
                            <th>ক্লাস</th>
                            <th>বেতনের পরিমাণ</th>
                            <th>স্ট্যাটাস</th>
                            <th>কার্যক্রম</th>
                        </tr>
                    </thead>
                    <tbody id="feeTableBody">
                        <!-- ডাটা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- পরীক্ষার ফি সেকশন -->
        <div id="examFee" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-file-invoice"></i> পরীক্ষার ফি ব্যবস্থাপনা</h2>
            
            <div class="row mb-4">
                <div class="col-md-4">
                    <label>পরীক্ষা নির্বাচন করুন</label>
                    <select class="form-control" id="examSelect" onchange="loadExamFeeData()">
                        <option value="১ম পরীক্ষা">১ম পরীক্ষা</option>
                        <option value="২য় পরীক্ষা">২য় পরীক্ষা</option>
                        <option value="৩য় পরীক্ষা">৩য় পরীক্ষা</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>ক্লাস নির্বাচন করুন</label>
                    <select class="form-control" id="examClassFilter" onchange="loadExamFeeData()">
                        <option value="">সকল ক্লাস</option>
                        <option value="শিশু জামাত">শিশু জামাত</option>
                        <option value="প্রথম জামাত">প্রথম জামাত</option>
                        <option value="দ্বিতীয় জামাত">দ্বিতীয় জামাত</option>
                        <option value="তৃতীয় জামাত">তৃতীয় জামাত</option>
                        <option value="হিফজ বিভাগ">হিফজ বিভাগ</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label>স্ট্যাটাস</label>
                    <select class="form-control" id="examStatusFilter" onchange="loadExamFeeData()">
                        <option value="">সকল</option>
                        <option value="paid">পরিশোধিত</option>
                        <option value="unpaid">বাকি</option>
                    </select>
                </div>
            </div>

            <div id="examFeeTableContainer">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>রোল নং</th>
                            <th>নাম</th>
                            <th>ক্লাস</th>
                            <th>ফি এর পরিমাণ</th>
                            <th>স্ট্যাটাস</th>
                            <th>কার্যক্রম</th>
                        </tr>
                    </thead>
                    <tbody id="examFeeTableBody">
                        <!-- ডাটা এখানে লোড হবে -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- রিপোর্ট সেকশন -->
        <div id="reports" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-file-alt"></i> রিপোর্ট</h2>
            
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card p-3">
                        <h5>বকেয়া ছাত্র তালিকা</h5>
                        <button class="btn btn-primary mt-2" onclick="generateUnpaidReport()">
                            <i class="fas fa-file-pdf"></i> PDF ডাউনলোড
                        </button>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card p-3">
                        <h5>ক্লাসভিত্তিক রিপোর্ট</h5>
                        <select class="form-control mt-2" id="reportClassSelect">
                            <option value="শিশু জামাত">শিশু জামাত</option>
                            <option value="প্রথম জামাত">প্রথম জামাত</option>
                            <option value="দ্বিতীয় জামাত">দ্বিতীয় জামাত</option>
                            <option value="তৃতীয় জামাত">তৃতীয় জামাত</option>
                            <option value="হিফজ বিভাগ">হিফজ বিভাগ</option>
                        </select>
                        <button class="btn btn-primary mt-2" onclick="generateClassReport()">
                            <i class="fas fa-file-pdf"></i> PDF ডাউনলোড
                        </button>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card p-3">
                        <h5>মাসিক আদায় রিপোর্ট</h5>
                        <input type="month" class="form-control mt-2" id="reportMonthSelect">
                        <button class="btn btn-primary mt-2" onclick="generateMonthlyReport()">
                            <i class="fas fa-file-pdf"></i> PDF ডাউনলোড
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ডেটা ব্যবস্থাপনা সেকশন -->
        <div id="dataManagement" class="content-area">
            <button class="back-btn" onclick="backToMenu()"><i class="fas fa-arrow-left"></i> মেনুতে ফিরুন</button>
            <h2><i class="fas fa-database"></i> ডেটা ব্যবস্থাপনা</h2>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="card p-4">
                        <h5><i class="fas fa-download"></i> ডেটা এক্সপোর্ট</h5>
                        <p>সম্পূর্ণ ডেটা এক্সপোর্ট করুন</p>
                        <button class="btn btn-success" onclick="exportData('excel')">
                            <i class="fas fa-file-excel"></i> Excel ডাউনলোড
                        </button>
                        <button class="btn btn-info mt-2" onclick="exportData('json')">
                            <i class="fas fa-file-code"></i> JSON ডাউনলোড
                        </button>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="card p-4">
                        <h5><i class="fas fa-upload"></i> ডেটা ইম্পোর্ট</h5>
                        <p>পূর্বের ডেটা পুনরুদ্ধার করুন</p>
                        <input type="file" id="importFile" class="form-control" accept=".json">
                        <button class="btn btn-warning mt-2" onclick="importData()">
                            <i class="fas fa-upload"></i> ইম্পোর্ট করুন
                        </button>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="card p-4">
                        <h5><i class="fas fa-sync"></i> ম্যানুয়াল সিঙ্ক</h5>
                        <p>Google Sheets এর সাথে সিঙ্ক করুন</p>
                        <button class="btn btn-primary" onclick="manualSync()">
                            <i class="fas fa-sync"></i> এখনই সিঙ্ক করুন
                        </button>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="card p-4">
                        <h5><i class="fas fa-trash"></i> লোকাল ডেটা মুছুন</h5>
                        <p>সাবধান: সকল লোকাল ডেটা মুছে যাবে</p>
                        <button class="btn btn-danger" onclick="clearLocalData()">
                            <i class="fas fa-trash"></i> ডেটা মুছুন
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ছাত্র যোগ/সম্পাদনা মোডাল -->
    <div id="studentModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="studentModalTitle">নতুন ছাত্র যোগ করুন</h3>
            <form id="studentForm" onsubmit="saveStudent(event)">
                <input type="hidden" id="studentId">
                
                <div class="form-group">
                    <label>রোল নম্বর *</label>
                    <input type="text" class="form-control" id="studentRoll" required>
                </div>
                
                <div class="form-group">
                    <label>ছাত্রের নাম *</label>
                    <input type="text" class="form-control" id="studentName" required>
                </div>
                
                <div class="form-group">
                    <label>পিতার নাম *</label>
                    <input type="text" class="form-control" id="fatherName" required>
                </div>
                
                <div class="form-group">
                    <label>ক্লাস *</label>
                    <select class="form-control" id="studentClass" required>
                        <option value="">নির্বাচন করুন</option>
                        <option value="শিশু জামাত">শিশু জামাত</option>
                        <option value="প্রথম জামাত">প্রথম জামাত</option>
                        <option value="দ্বিতীয় জামাত">দ্বিতীয় জামাত</option>
                        <option value="তৃতীয় জামাত">তৃতীয় জামাত</option>
                        <option value="হিফজ বিভাগ">হিফজ বিভাগ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>মোবাইল নম্বর *</label>
                    <input type="tel" class="form-control" id="studentPhone" pattern="01[0-9]{9}" placeholder="01XXXXXXXXX" required>
                </div>
                
                <div class="form-group">
                    <label>ঠিকানা</label>
                    <textarea class="form-control" id="studentAddress" rows="2"></textarea>
                </div>
                
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> সংরক্ষণ করুন
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeStudentModal()">
                        <i class="fas fa-times"></i> বাতিল
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- বেতন পরিশোধ মোডাল -->
    <div id="feePaymentModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>বেতন পরিশোধ</h3>
            <form id="feePaymentForm" onsubmit="processFeePayment(event)">
                <input type="hidden" id="feeStudentId">
                
                <div class="form-group">
                    <label>ছাত্রের নাম</label>
                    <input type="text" class="form-control" id="feeStudentName" readonly>
                </div>
                
                <div class="form-group">
                    <label>মাস</label>
                    <input type="text" class="form-control" id="feePaymentMonth" readonly>
                </div>
                
                <div class="form-group">
                    <label>বেতনের পরিমাণ</label>
                    <input type="number" class="form-control" id="feeAmount" readonly>
                </div>
                
                <div class="form-group">
                    <label>পরিশোধের তারিখ</label>
                    <input type="date" class="form-control" id="feePaymentDate" required>
                </div>
                
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i> পরিশোধ সম্পন্ন
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeFeePaymentModal()">
                        <i class="fas fa-times"></i> বাতিল
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- রসিদ মোডাল -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div class="receipt" id="receiptContent">
                <div class="receipt-header">
                    <i class="fas fa-mosque" style="font-size: 3rem; color: #667eea;"></i>
                    <h2>নুরুল কোরআন কওমী মাদ্রাসা</h2>
                    <p>বেতন/ফি রসিদ</p>
                </div>
                <div class="receipt-body">
                    <div class="receipt-row">
                        <strong>রসিদ নং:</strong>
                        <span id="receiptNo"></span>
                    </div>
                    <div class="receipt-row">
                        <strong>তারিখ:</strong>
                        <span id="receiptDate"></span>
                    </div>
                    <div class="receipt-row">
                        <strong>ছাত্রের নাম:</strong>
                        <span id="receiptStudentName"></span>
                    </div>
                    <div class="receipt-row">
                        <strong>রোল নং:</strong>
                        <span id="receiptRoll"></span>
                    </div>
                    <div class="receipt-row">
                        <strong>ক্লাস:</strong>
                        <span id="receiptClass"></span>
                    </div>
                    <div class="receipt-row">
                        <strong>বিবরণ:</strong>
                        <span id="receiptDescription"></span>
                    </div>
                    <div class="receipt-row" style="font-size: 1.2rem; font-weight: bold;">
                        <strong>পরিমাণ:</strong>
                        <span id="receiptAmount"></span>
                    </div>
                </div>
                <div class="receipt-footer">
                    <p>আল্লাহ আপনাকে বরকত দান করুন</p>
                    <div style="margin-top: 50px;">
                        <p>_________________</p>
                        <p>কর্তৃপক্ষের স্বাক্ষর</p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <button class="btn btn-primary" onclick="printReceipt()">
                    <i class="fas fa-print"></i> প্রিন্ট করুন
                </button>
                <button class="btn btn-secondary" onclick="closeReceiptModal()">
                    <i class="fas fa-times"></i> বন্ধ করুন
                </button>
            </div>
        </div>
    </div>

    <!-- স্ক্রিপ্ট -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        // গ্লোবাল ভেরিয়েবল
        let students = [];
        let feeRecords = [];
        let examFeeRecords = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let isOnline = navigator.onLine;
        
        // Google Apps Script Web App URL (এটি আপনার Apps Script URL দিয়ে রিপ্লেস করুন)
        const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
        
        // ক্লাস অনুযায়ী ফি স্ট্রাকচার
        const feeStructure = {
            'শিশু জামাত': { monthly: 150, exam: 150 },
            'প্রথম জামাত': { monthly: 200, exam: 200 },
            'দ্বিতীয় জামাত': { monthly: 250, exam: 250 },
            'তৃতীয় জামাত': { monthly: 300, exam: 300 },
            'হিফজ বিভাগ': { monthly: 800, exam: 500 }
        };

        // পেজ লোড হলে
        window.addEventListener('load', function() {
            initializeApp();
            checkOnlineStatus();
            setInterval(checkOnlineStatus, 5000);
            
            // অফলাইন/অনলাইন ইভেন্ট
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
            
            // বর্তমান মাস সেট করুন
            const now = new Date();
            const currentMonth = now.toISOString().slice(0, 7);
            document.getElementById('feeMonth').value = currentMonth;
            document.getElementById('reportMonthSelect').value = currentMonth;
            document.getElementById('feePaymentDate').value = now.toISOString().slice(0, 10);
        });

        // অ্যাপ ইনিশিয়ালাইজ
        function initializeApp() {
            loadFromLocalStorage();
            syncWithGoogleSheets();
        }

        // অনলাইন স্ট্যাটাস চেক
        function checkOnlineStatus() {
            isOnline = navigator.onLine;
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (isOnline) {
                statusDot.className = 'status-dot online';
                statusText.textContent = 'অনলাইন';
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'অফলাইন';
            }
        }

        function handleOnline() {
            isOnline = true;
            checkOnlineStatus();
            syncWithGoogleSheets();
        }

        function handleOffline() {
            isOnline = false;
            checkOnlineStatus();
        }

        // সেকশন দেখান
        function showSection(sectionId) {
            document.getElementById('mainMenu').style.display = 'none';
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            // সেকশন অনুযায়ী ডেটা লোড
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'studentManagement') {
                loadStudentTable();
            } else if (sectionId === 'feeManagement') {
                loadFeeData();
            } else if (sectionId === 'examFee') {
                loadExamFeeData();
            }
        }

        // মেনুতে ফিরুন
        function backToMenu() {
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById('mainMenu').style.display = 'grid';
        }

        // ছাত্র যোগ ফর্ম দেখান
        function showAddStudentForm() {
            document.getElementById('studentModalTitle').textContent = 'নতুন ছাত্র যোগ করুন';
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
            document.getElementById('studentModal').classList.add('active');
        }

        // ছাত্র সম্পাদনা
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (student) {
                document.getElementById('studentModalTitle').textContent = 'ছাত্র সম্পাদনা';
                document.getElementById('studentId').value = student.id;
                document.getElementById('studentRoll').value = student.roll;
                document.getElementById('studentName').value = student.name;
                document.getElementById('fatherName').value = student.fatherName;
                document.getElementById('studentClass').value = student.class;
                document.getElementById('studentPhone').value = student.phone;
                document.getElementById('studentAddress').value = student.address;
                document.getElementById('studentModal').classList.add('active');
            }
        }

        // ছাত্র মুছুন
        function deleteStudent(id) {
            if (confirm('আপনি কি নিশ্চিত এই ছাত্রকে মুছে ফেলতে চান?')) {
                students = students.filter(s => s.id !== id);
                saveToLocalStorage();
                syncWithGoogleSheets();
                loadStudentTable();
                alert('ছাত্র সফলভাবে মুছে ফেলা হয়েছে');
            }
        }

        // ছাত্র সংরক্ষণ
        function saveStudent(event) {
            event.preventDefault();
            
            const studentData = {
                id: document.getElementById('studentId').value || Date.now().toString(),
                roll: document.getElementById('studentRoll').value,
                name: document.getElementById('studentName').value,
                fatherName: document.getElementById('fatherName').value,
                class: document.getElementById('studentClass').value,
                phone: document.getElementById('studentPhone').value,
                address: document.getElementById('studentAddress').value,
                createdAt: new Date().toISOString()
            };
            
            const existingIndex = students.findIndex(s => s.id === studentData.id);
            if (existingIndex >= 0) {
                students[existingIndex] = studentData;
            } else {
                students.push(studentData);
            }
            
            saveToLocalStorage();
            syncWithGoogleSheets();
            closeStudentModal();
            loadStudentTable();
            alert('ছাত্র সফলভাবে সংরক্ষণ করা হয়েছে');
        }

        // ছাত্র মোডাল বন্ধ
        function closeStudentModal() {
            document.getElementById('studentModal').classList.remove('active');
        }

        // ছাত্র টেবিল লোড
        function loadStudentTable(page = 1) {
            currentPage = page;
            const classFilter = document.getElementById('classFilter').value;
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            
            let filteredStudents = students;
            
            if (classFilter) {
                filteredStudents = filteredStudents.filter(s => s.class === classFilter);
            }
            
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(s => 
                    s.name.toLowerCase().includes(searchTerm) || 
                    s.roll.toLowerCase().includes(searchTerm)
                );
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedStudents = filteredStudents.slice(startIndex, endIndex);
            
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';
            
            paginatedStudents.forEach(student => {
                const row = `
                    <tr>
                        <td>${student.roll}</td>
                        <td>${student.name}</td>
                        <td>${student.fatherName}</td>
                        <td>${student.class}</td>
                        <td><a href="tel:${student.phone}" class="phone-link"><i class="fas fa-phone"></i> ${student.phone}</a></td>
                        <td>${student.address}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editStudent('${student.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStudent('${student.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            // পেজিনেশন
            const totalPages = Math.ceil(filteredStudents.length / itemsPerPage);
            const pagination = document.getElementById('studentPagination');
            pagination.innerHTML = '';
            
            if (totalPages > 1) {
                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    btn.disabled = i === currentPage;
                    btn.onclick = () => loadStudentTable(i);
                    pagination.appendChild(btn);
                }
            }
        }

        function filterStudents() {
            loadStudentTable(1);
        }

        function searchStudents() {
            loadStudentTable(1);
        }

        // বেতন ডেটা লোড
        function loadFeeData() {
            const month = document.getElementById('feeMonth').value;
            const classFilter = document.getElementById('feeClassFilter').value;
            const statusFilter = document.getElementById('feeStatusFilter').value;
            
            if (!month) return;
            
            let filteredStudents = students;
            if (classFilter) {
                filteredStudents = filteredStudents.filter(s => s.class === classFilter);
            }
            
            const tbody = document.getElementById('feeTableBody');
            tbody.innerHTML = '';
            
            filteredStudents.forEach(student => {
                const feeAmount = feeStructure[student.class].monthly;
                const feeRecord = feeRecords.find(f => 
                    f.studentId === student.id && f.month === month
                );
                const isPaid = feeRecord && feeRecord.paid;
                
                if (statusFilter === 'paid' && !isPaid) return;
                if (statusFilter === 'unpaid' && isPaid) return;
                
                const row = `
                    <tr>
                        <td>${student.roll}</td>
                        <td>${student.name}</td>
                        <td>${student.class}</td>
                        <td>${feeAmount} ৳</td>
                        <td>
                            ${isPaid ? 
                                '<span class="badge bg-success">পরিশোধিত</span>' : 
                                '<span class="badge bg-danger">বাকি</span>'}
                        </td>
                        <td>
                            ${!isPaid ? 
                                `<button class="btn btn-sm btn-success" onclick="showFeePaymentModal('${student.id}', '${month}', ${feeAmount})">
                                    <i class="fas fa-money-bill"></i> পরিশোধ
                                </button>` : 
                                `<button class="btn btn-sm btn-info" onclick="showReceipt('${student.id}', '${month}', 'monthly')">
                                    <i class="fas fa-receipt"></i> রসিদ
                                </button>`}
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // বেতন পরিশোধ মোডাল দেখান
        function showFeePaymentModal(studentId, month, amount) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                document.getElementById('feeStudentId').value = studentId;
                document.getElementById('feeStudentName').value = student.name;
                document.getElementById('feePaymentMonth').value = month;
                document.getElementById('feeAmount').value = amount;
                document.getElementById('feePaymentModal').classList.add('active');
            }
        }

        // বেতন পরিশোধ প্রসেস
        function processFeePayment(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('feeStudentId').value;
            const month = document.getElementById('feePaymentMonth').value;
            const amount = parseInt(document.getElementById('feeAmount').value);
            const paymentDate = document.getElementById('feePaymentDate').value;
            
            const feeRecord = {
                id: Date.now().toString(),
                studentId: studentId,
                month: month,
                amount: amount,
                paid: true,
                paymentDate: paymentDate,
                type: 'monthly'
            };
            
            feeRecords.push(feeRecord);
            saveToLocalStorage();
            syncWithGoogleSheets();
            closeFeePaymentModal();
            loadFeeData();
            showReceipt(studentId, month, 'monthly');
        }

        // বেতন পরিশোধ মোডাল বন্ধ
        function closeFeePaymentModal() {
            document.getElementById('feePaymentModal').classList.remove('active');
        }

        // পরীক্ষার ফি ডেটা লোড
        function loadExamFeeData() {
            const exam = document.getElementById('examSelect').value;
            const classFilter = document.getElementById('examClassFilter').value;
            const statusFilter = document.getElementById('examStatusFilter').value;
            
            let filteredStudents = students;
            if (classFilter) {
                filteredStudents = filteredStudents.filter(s => s.class === classFilter);
            }
            
            const tbody = document.getElementById('examFeeTableBody');
            tbody.innerHTML = '';
            
            filteredStudents.forEach(student => {
                const feeAmount = feeStructure[student.class].exam;
                const examRecord = examFeeRecords.find(f => 
                    f.studentId === student.id && f.exam === exam
                );
                const isPaid = examRecord && examRecord.paid;
                
                if (statusFilter === 'paid' && !isPaid) return;
                if (statusFilter === 'unpaid' && isPaid) return;
                
                const row = `
                    <tr>
                        <td>${student.roll}</td>
                        <td>${student.name}</td>
                        <td>${student.class}</td>
                        <td>${feeAmount} ৳</td>
                        <td>
                            ${isPaid ? 
                                '<span class="badge bg-success">পরিশোধিত</span>' : 
                                '<span class="badge bg-danger">বাকি</span>'}
                        </td>
                        <td>
                            ${!isPaid ? 
                                `<button class="btn btn-sm btn-success" onclick="processExamFee('${student.id}', '${exam}', ${feeAmount})">
                                    <i class="fas fa-money-bill"></i> পরিশোধ
                                </button>` : 
                                `<button class="btn btn-sm btn-info" onclick="showReceipt('${student.id}', '${exam}', 'exam')">
                                    <i class="fas fa-receipt"></i> রসিদ
                                </button>`}
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // পরীক্ষার ফি পরিশোধ
        function processExamFee(studentId, exam, amount) {
            if (confirm('পরীক্ষার ফি পরিশোধ নিশ্চিত করুন?')) {
                const examRecord = {
                    id: Date.now().toString(),
                    studentId: studentId,
                    exam: exam,
                    amount: amount,
                    paid: true,
                    paymentDate: new Date().toISOString().slice(0, 10),
                    type: 'exam'
                };
                
                examFeeRecords.push(examRecord);
                saveToLocalStorage();
                syncWithGoogleSheets();
                loadExamFeeData();
                showReceipt(studentId, exam, 'exam');
            }
        }

        // রসিদ দেখান
        function showReceipt(studentId, period, type) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            let record, amount, description;
            
            if (type === 'monthly') {
                record = feeRecords.find(f => f.studentId === studentId && f.month === period);
                amount = feeStructure[student.class].monthly;
                description = `মাসিক বেতন - ${period}`;
            } else {
                record = examFeeRecords.find(f => f.studentId === studentId && f.exam === period);
                amount = feeStructure[student.class].exam;
                description = `পরীক্ষার ফি - ${period}`;
            }
            
            document.getElementById('receiptNo').textContent = record.id;
            document.getElementById('receiptDate').textContent = new Date(record.paymentDate).toLocaleDateString('bn-BD');
            document.getElementById('receiptStudentName').textContent = student.name;
            document.getElementById('receiptRoll').textContent = student.roll;
            document.getElementById('receiptClass').textContent = student.class;
            document.getElementById('receiptDescription').textContent = description;
            document.getElementById('receiptAmount').textContent = amount + ' ৳';
            
            document.getElementById('receiptModal').classList.add('active');
        }

        // রসিদ প্রিন্ট
        function printReceipt() {
            window.print();
        }

        // রসিদ মোডাল বন্ধ
        function closeReceiptModal() {
            document.getElementById('receiptModal').classList.remove('active');
        }

        // ড্যাশবোর্ড লোড
        function loadDashboard() {
            const totalStudents = students.length;
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            const paidStudents = students.filter(student => {
                return feeRecords.some(f => 
                    f.studentId === student.id && 
                    f.month === currentMonth && 
                    f.paid
                );
            }).length;
            
            const unpaidStudents = totalStudents - paidStudents;
            
            const totalCollection = feeRecords
                .filter(f => f.month === currentMonth && f.paid)
                .reduce((sum, f) => sum + f.amount, 0);
            
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('paidStudents').textContent = paidStudents;
            document.getElementById('unpaidStudents').textContent = unpaidStudents;
            document.getElementById('totalCollection').textContent = totalCollection.toLocaleString('bn-BD') + ' ৳';
            
            // চার্ট
            loadCharts();
        }

        // চার্ট লোড
        function loadCharts() {
            // ক্লাসভিত্তিক চার্ট
            const classCounts = {};
            students.forEach(student => {
                classCounts[student.class] = (classCounts[student.class] || 0) + 1;
            });
            
            const classChartCtx = document.getElementById('classChart');
            if (window.classChart) window.classChart.destroy();
            window.classChart = new Chart(classChartCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(classCounts),
                    datasets: [{
                        label: 'ছাত্র সংখ্যা',
                        data: Object.values(classCounts),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // মাসিক আদায় চার্ট
            const collectionData = [0, 0, 0, 0, 0, 0];
            const months = [];
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthStr = date.toISOString().slice(0, 7);
                months.push(monthStr);
                
                const monthTotal = feeRecords
                    .filter(f => f.month === monthStr && f.paid)
                    .reduce((sum, f) => sum + f.amount, 0);
                collectionData[5 - i] = monthTotal;
            }
            
            const collectionChartCtx = document.getElementById('collectionChart');
            if (window.collectionChart) window.collectionChart.destroy();
            window.collectionChart = new Chart(collectionChartCtx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'আদায় (৳)',
                        data: collectionData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // রিপোর্ট জেনারেট (বকেয়া ছাত্র)
        function generateUnpaidReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            const unpaidStudents = students.filter(student => {
                return !feeRecords.some(f => 
                    f.studentId === student.id && 
                    f.month === currentMonth && 
                    f.paid
                );
            });
            
            doc.setFontSize(18);
            doc.text('Nurul Quran Madrasa', 105, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text('Unpaid Students Report', 105, 30, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Month: ${currentMonth}`, 105, 40, { align: 'center' });
            
            const tableData = unpaidStudents.map(s => [
                s.roll,
                s.name,
                s.fatherName,
                s.class,
                s.phone,
                feeStructure[s.class].monthly + ' Tk'
            ]);
            
            doc.autoTable({
                startY: 50,
                head: [['Roll', 'Name', 'Father', 'Class', 'Phone', 'Amount']],
                body: tableData
            });
            
            doc.save(`unpaid-students-${currentMonth}.pdf`);
        }

        // ক্লাসভিত্তিক রিপোর্ট
        function generateClassReport() {
            const selectedClass = document.getElementById('reportClassSelect').value;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const classStudents = students.filter(s => s.class === selectedClass);
            
            doc.setFontSize(18);
            doc.text('Nurul Quran Madrasa', 105, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text(`Class Report: ${selectedClass}`, 105, 30, { align: 'center' });
            
            const tableData = classStudents.map(s => [
                s.roll,
                s.name,
                s.fatherName,
                s.phone,
                s.address
            ]);
            
            doc.autoTable({
                startY: 40,
                head: [['Roll', 'Name', 'Father', 'Phone', 'Address']],
                body: tableData
            });
            
            doc.save(`class-report-${selectedClass}.pdf`);
        }

        // মাসিক রিপোর্ট
        function generateMonthlyReport() {
            const month = document.getElementById('reportMonthSelect').value;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(18);
            doc.text('Nurul Quran Madrasa', 105, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text(`Monthly Collection Report`, 105, 30, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Month: ${month}`, 105, 40, { align: 'center' });
            
            const monthRecords = feeRecords.filter(f => f.month === month && f.paid);
            const totalCollection = monthRecords.reduce((sum, f) => sum + f.amount, 0);
            
            const tableData = monthRecords.map(record => {
                const student = students.find(s => s.id === record.studentId);
                return [
                    student.roll,
                    student.name,
                    student.class,
                    record.amount + ' Tk',
                    new Date(record.paymentDate).toLocaleDateString()
                ];
            });
            
            doc.autoTable({
                startY: 50,
                head: [['Roll', 'Name', 'Class', 'Amount', 'Date']],
                body: tableData,
                foot: [['', '', 'Total:', totalCollection + ' Tk', '']]
            });
            
            doc.save(`monthly-report-${month}.pdf`);
        }

        // ডেটা এক্সপোর্ট
        function exportData(format) {
            if (format === 'excel') {
                const wb = XLSX.utils.book_new();
                
                const studentsWS = XLSX.utils.json_to_sheet(students);
                XLSX.utils.book_append_sheet(wb, studentsWS, 'Students');
                
                const feeWS = XLSX.utils.json_to_sheet(feeRecords);
                XLSX.utils.book_append_sheet(wb, feeWS, 'Fee Records');
                
                const examWS = XLSX.utils.json_to_sheet(examFeeRecords);
                XLSX.utils.book_append_sheet(wb, examWS, 'Exam Fee');
                
                XLSX.writeFile(wb, `madrasa-data-${new Date().toISOString().slice(0, 10)}.xlsx`);
            } else if (format === 'json') {
                const data = {
                    students: students,
                    feeRecords: feeRecords,
                    examFeeRecords: examFeeRecords,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `madrasa-data-${new Date().toISOString().slice(0, 10)}.json`;
                a.click();
            }
        }

        // ডেটা ইম্পোর্ট
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('অনুগ্রহ করে একটি ফাইল নির্বাচন করুন');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    students = data.students || [];
                    feeRecords = data.feeRecords || [];
                    examFeeRecords = data.examFeeRecords || [];
                    
                    saveToLocalStorage();
                    syncWithGoogleSheets();
                    alert('ডেটা সফলভাবে ইম্পোর্ট হয়েছে');
                } catch (error) {
                    alert('ফাইল পড়তে সমস্যা হয়েছে');
                }
            };
            reader.readAsText(file);
        }

        // লোকাল স্টোরেজে সংরক্ষণ
        function saveToLocalStorage() {
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('feeRecords', JSON.stringify(feeRecords));
            localStorage.setItem('examFeeRecords', JSON.stringify(examFeeRecords));
        }

        // লোকাল স্টোরেজ থেকে লোড
        function loadFromLocalStorage() {
            const savedStudents = localStorage.getItem('students');
            const savedFeeRecords = localStorage.getItem('feeRecords');
            const savedExamFeeRecords = localStorage.getItem('examFeeRecords');
            
            if (savedStudents) students = JSON.parse(savedStudents);
            if (savedFeeRecords) feeRecords = JSON.parse(savedFeeRecords);
            if (savedExamFeeRecords) examFeeRecords = JSON.parse(savedExamFeeRecords);
        }

        // ম্যানুয়াল সিঙ্ক
        function manualSync() {
            syncWithGoogleSheets();
            alert('সিঙ্ক শুরু হয়েছে...');
        }

        // লোকাল ডেটা মুছুন
        function clearLocalData() {
            if (confirm('আপনি কি নিশ্চিত সকল লোকাল ডেটা মুছে ফেলতে চান? এই কাজ পূর্বাবস্থায় ফেরানো যাবে না!')) {
                localStorage.clear();
                students = [];
                feeRecords = [];
                examFeeRecords = [];
                alert('সকল লোকাল ডেটা মুছে ফেলা হয়েছে');
                location.reload();
            }
        }

        // Google Sheets এর সাথে সিঙ্ক
        async function syncWithGoogleSheets() {
            if (!isOnline) {
                console.log('Offline mode - data saved locally');
                return;
            }
            
            if (SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                console.log('Google Apps Script URL not configured');
                return;
            }
            
            try {
                // ডেটা পাঠান
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'syncData',
                        students: students,
                        feeRecords: feeRecords,
                        examFeeRecords: examFeeRecords
                    })
                });
                
                document.getElementById('lastSync').textContent = 'শেষ সিঙ্ক: ' + new Date().toLocaleTimeString('bn-BD');
            } catch (error) {
                console.error('Sync error:', error);
            }
        }

        // Google Sheets থেকে ডেটা লোড
        async function loadFromGoogleSheets() {
            if (!isOnline || SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                return;
            }
            
            try {
                const response = await fetch(SCRIPT_URL + '?action=getData');
                const data = await response.json();
                
                if (data.students) students = data.students;
                if (data.feeRecords) feeRecords = data.feeRecords;
                if (data.examFeeRecords) examFeeRecords = data.examFeeRecords;
                
                saveToLocalStorage();
            } catch (error) {
                console.error('Load error:', error);
            }
        }
    </script>
</body>
</html>
